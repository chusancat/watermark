<!DOCTYPE html>
<html>

<head>
    <title>åå°æ•°æ®ç®¡ç†</title>
    <style>
        body {
            font-family: sans-serif;
            padding: 20px;
            background: #f4f4f9;
        }

        h2 {
            border-bottom: 2px solid #333;
            padding-bottom: 10px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        th,
        td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        th {
            background-color: #007bff;
            color: white;
        }

        .thumb {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 4px;
            cursor: pointer;
        }

        .badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            color: white;
        }

        .badge-work {
            background: #28a745;
        }

        .badge-life {
            background: #17a2b8;
        }

        .badge-default {
            background: #6c757d;
        }
    </style>
</head>

<body>

    <h2>ğŸ“¸ ç…§ç‰‡æ•°æ®ä¸­å¿ƒ</h2>
    <div id="loading">æ­£åœ¨åŠ è½½æ•°æ®...</div>

    <table>
        <thead>
            <tr>
                <th>é¢„è§ˆ</th>
                <th>ä¸Šä¼ æ—¶é—´</th>
                <th>åœ°ç†ä½ç½® (Meta)</th>
                <th>ç»çº¬åº¦</th>
                <th>åˆ†ç»„</th>
                <th>æ“ä½œ</th>
            </tr>
        </thead>
        <tbody id="data-body"></tbody>
    </table>

    <script>
        async function loadData() {
            const res = await fetch('/api/list-photos');
            const files = await res.json();
            document.getElementById('loading').style.display = 'none';

            const tbody = document.getElementById('data-body');

            files.sort((a, b) => new Date(b.lastModified) - new Date(a.lastModified)); // æŒ‰æ—¶é—´å€’åº

            files.forEach(file => {
                const meta = file.metadata || {};
                // è§£ç å¯èƒ½çš„ URL ç¼–ç ä¸­æ–‡
                let locName = meta['location-name'] || '-';
                try { locName = decodeURIComponent(locName); } catch (e) { }

                const group = meta['img-group'] || 'default';
                const badgeClass = group === 'å·¥ä½œ' ? 'badge-work' : (group === 'ç”Ÿæ´»' ? 'badge-life' : 'badge-default');

                const tr = document.createElement('tr');
                tr.innerHTML = `
                <td><a href="${file.url}" target="_blank"><img src="${file.url}" class="thumb"></a></td>
                <td>${new Date(file.lastModified).toLocaleString()}</td>
                <td>${locName}</td>
                <td>${meta['geo-lat'] || ''}, ${meta['geo-lon'] || ''}</td>
                <td><span class="badge ${badgeClass}">${group}</span></td>
                <td><a href="${file.url}" download="photo.jpg">ä¸‹è½½åŸå›¾</a></td>
            `;
                tbody.appendChild(tr);
            });
        }

        loadData();
    </script>
</body>

</html>